{
  "version": "1.0",
  "module": "unnamed",
  "metadata": {
    "compiled_at": "2026-01-19T08:11:05Z",
    "compiler_version": "0.1.0"
  },
  "components": [
    {
      "id": 0,
      "name": "Character",
      "fields": [
        {
          "name": "name",
          "type": {
            "type": "string"
          }
        },
        {
          "name": "level",
          "type": {
            "type": "number"
          }
        }
      ]
    },
    {
      "id": 1,
      "name": "Health",
      "fields": [
        {
          "name": "current",
          "type": {
            "type": "number"
          }
        },
        {
          "name": "max",
          "type": {
            "type": "number"
          }
        }
      ]
    },
    {
      "id": 2,
      "name": "Attack",
      "fields": [
        {
          "name": "damage",
          "type": {
            "type": "number"
          }
        },
        {
          "name": "speed",
          "type": {
            "type": "number"
          }
        }
      ]
    },
    {
      "id": 3,
      "name": "Target",
      "fields": [
        {
          "name": "entity",
          "type": {
            "type": "entity"
          }
        }
      ]
    }
  ],
  "rules": [
    {
      "id": 0,
      "name": "attack_rule",
      "trigger": {
        "type": "event",
        "event": "DoAttack"
      },
      "actions": [
        {
          "type": "conditional",
          "condition": {
            "type": "binary",
            "op": "neq",
            "left": {
              "type": "field",
              "entity": "entity",
              "component": "Target",
              "field": "entity"
            },
            "right": {
              "type": "literal",
              "value": null
            }
          },
          "then_actions": [
            {
              "type": "modify",
              "entity": {
                "type": "var",
                "name": "target"
              },
              "component": "Health",
              "field": "current",
              "op": "subtract",
              "value": {
                "type": "var",
                "name": "damage"
              }
            },
            {
              "type": "schedule",
              "event": "DoAttack",
              "delay": {
                "type": "var",
                "name": "delay"
              },
              "fields": {
                "source": {
                  "type": "var",
                  "name": "id"
                }
              }
            }
          ]
        }
      ]
    },
    {
      "id": 1,
      "name": "death_check",
      "trigger": {
        "type": "event",
        "event": "DoAttack"
      },
      "actions": [
        {
          "type": "conditional",
          "condition": {
            "type": "binary",
            "op": "lte",
            "left": {
              "type": "field",
              "entity": "entity",
              "component": "Health",
              "field": "current"
            },
            "right": {
              "type": "literal",
              "value": 0.0
            }
          },
          "then_actions": [
            {
              "type": "schedule",
              "event": "Death",
              "fields": {
                "target": {
                  "type": "var",
                  "name": "id"
                }
              }
            }
          ]
        }
      ]
    }
  ],
  "functions": [
    {
      "id": 0,
      "name": "calculate_damage",
      "params": [
        {
          "name": "base",
          "type": {
            "type": "number"
          }
        },
        {
          "name": "multiplier",
          "type": {
            "type": "number"
          }
        }
      ],
      "return_type": {
        "type": "number"
      },
      "body": {
        "type": "binary",
        "op": "multiply",
        "left": {
          "type": "var",
          "name": "base"
        },
        "right": {
          "type": "var",
          "name": "multiplier"
        }
      }
    }
  ],
  "source_map": {
    "files": [
      {
        "path": "../../game/brl/simple-combat.brl",
        "content": "// Simple Combat System\n// Demonstrates combat mechanics with health, damage, and death\n\n// Character information\ncomponent Character {\n    name: string\n    level: integer\n}\n\n// Health component\ncomponent Health {\n    current: integer\n    max: integer\n}\n\n// Attack capability\ncomponent Attack {\n    damage: integer\n    speed: float\n}\n\n// Current attack target\ncomponent Target {\n    entity: id?\n}\n\n// Function to calculate damage with multiplier\nfn calculate_damage(base: float, multiplier: float): float {\n    return base * multiplier\n}\n\n// Main attack rule: apply damage and schedule next attack\nrule attack_rule on DoAttack {\n    // Only attack if we have a target\n    if entity.Target.entity != null {\n        let target = entity.Target.entity\n        let damage = entity.Attack.damage\n        \n        // Apply damage to target\n        target.Health.current -= damage\n        \n        // Schedule next attack based on attack speed\n        let delay = 100 / entity.Attack.speed\n        schedule [delay: delay] DoAttack {\n            source: entity.id\n        }\n    }\n}\n\n// Death check: emit Death event when health drops to zero\nrule death_check on DoAttack {\n    if entity.Health.current <= 0 {\n        schedule Death {\n            target: entity.id\n        }\n    }\n}\n",
        "language": "brl"
      },
      {
        "path": "../../game/bcl/cleric-skills.bcl",
        "content": "// Cleric Skill Choices BCL\n// Defines skill selection strategy for the Cleric class\n\nmodule cleric_skills\n\n// === SKILL TREE DEFINITIONS ===\n// Tier 1 Skills (Level 2+)\n// - heal: Restore health to target (15 mana)\n// - smite: Holy damage to single enemy (10 mana)\n// - bless: Increase ally damage (12 mana)\n\n// Tier 2 Skills (Level 4+)\n// - group_heal: Heal all allies (35 mana)\n// - holy_shield: Absorb damage on ally (25 mana)\n// - divine_light: Damage and heal (30 mana)\n\n// Tier 3 Skills (Level 7+)\n// - resurrection: Revive fallen ally (100 mana)\n// - sanctuary: Make ally immune briefly (60 mana)\n// - divine_storm: Massive holy AoE (80 mana)\n\n// === HELPER FUNCTIONS ===\n\nfn health_percentage(entity): float {\n    return entity.Health.current / entity.Health.max\n}\n\nfn mana_percentage(entity): float {\n    return entity.Mana.current / entity.Mana.max\n}\n\nfn can_cast(character, manaCost): boolean {\n    return character.Mana.current >= manaCost\n}\n\nfn find_most_injured_ally(allies: list): id {\n    let mostInjured = allies[0]\n    let lowestPct = 1.0\n    \n    for ally in allies {\n        let hp_pct = ally.Health.current / ally.Health.max\n        if hp_pct < lowestPct {\n            mostInjured = ally\n            lowestPct = hp_pct\n        }\n    }\n    \n    return mostInjured.id\n}\n\nfn count_injured_allies(allies: list, threshold: float): number {\n    let count = 0\n    for ally in allies {\n        let hp_pct = ally.Health.current / ally.Health.max\n        if hp_pct < threshold {\n            count = count + 1\n        }\n    }\n    return count\n}\n\n// === SKILL CHOICE IMPLEMENTATION ===\n\n// Called when cleric levels up and gains a skill point\nchoice fn select_skill_on_levelup(\n    character: Character & Skills,\n    currentLevel: number\n): string {\n    // At level 2, get heal first\n    if currentLevel == 2 {\n        return \"heal\"\n    }\n    \n    // At level 3, get bless for damage support\n    if currentLevel == 3 {\n        return \"bless\"\n    }\n    \n    // At level 4, get smite for offense\n    if currentLevel == 4 {\n        return \"smite\"\n    }\n    \n    // At level 5, get group heal\n    if currentLevel == 5 {\n        return \"group_heal\"\n    }\n    \n    // At level 6, get holy shield for protection\n    if currentLevel == 6 {\n        return \"holy_shield\"\n    }\n    \n    // At level 7+, get resurrection\n    if currentLevel >= 7 {\n        return \"resurrection\"\n    }\n    \n    return \"heal\"\n}\n\n// === COMBAT SKILL SELECTION ===\n\n// Called each combat round to select which skill to use\nchoice fn select_combat_skill(\n    character: Character & Skills & Health & Mana & Combat,\n    allies: list,\n    enemies: list\n): string {\n    let hp_pct = health_percentage(character)\n    let mana_pct = mana_percentage(character)\n    \n    // Check for dead allies that need resurrection\n    for ally in allies {\n        if ally.Health.current <= 0 {\n            if can_cast(character, 100) && character.Skills.skill4 == \"resurrection\" {\n                return \"resurrection\"\n            }\n        }\n    }\n    \n    // Emergency self-heal\n    if hp_pct < 0.25 && can_cast(character, 15) {\n        if character.Skills.skill1 == \"heal\" {\n            return \"heal\"\n        }\n    }\n    \n    // Check how many allies need healing\n    let injuredCount = count_injured_allies(allies, 0.6)\n    \n    // Multiple allies injured - use group heal\n    if injuredCount >= 2 && can_cast(character, 35) {\n        if character.Skills.skill3 == \"group_heal\" {\n            return \"group_heal\"\n        }\n    }\n    \n    // Single ally critically injured - use single target heal\n    for ally in allies {\n        let ally_hp_pct = ally.Health.current / ally.Health.max\n        if ally_hp_pct < 0.3 && can_cast(character, 15) {\n            if character.Skills.skill1 == \"heal\" {\n                return \"heal\"\n            }\n        }\n    }\n    \n    // Tank is taking heavy damage - use holy shield\n    for ally in allies {\n        if ally.Character.class == \"Warrior\" {\n            let ally_hp_pct = ally.Health.current / ally.Health.max\n            if ally_hp_pct < 0.5 && can_cast(character, 25) {\n                if character.Skills.skill3 == \"holy_shield\" {\n                    return \"holy_shield\"\n                }\n            }\n        }\n    }\n    \n    // Everyone healthy - use offensive abilities\n    if injuredCount == 0 {\n        // Divine storm on multiple enemies\n        if enemies.count >= 2 && can_cast(character, 80) {\n            if character.Skills.skill4 == \"divine_storm\" {\n                return \"divine_storm\"\n            }\n        }\n        \n        // Bless the highest damage ally\n        if can_cast(character, 12) && character.Skills.skill2 == \"bless\" {\n            return \"bless\"\n        }\n        \n        // Smite for damage\n        if can_cast(character, 10) && character.Skills.skill2 == \"smite\" {\n            return \"smite\"\n        }\n    }\n    \n    // Moderate injuries - divine light for combo heal/damage\n    if can_cast(character, 30) && character.Skills.skill3 == \"divine_light\" {\n        return \"divine_light\"\n    }\n    \n    // Low mana - conserve with basic attack\n    return \"basic_attack\"\n}\n\n// === TARGET SELECTION FOR HEALING ===\n\nchoice fn select_heal_target(\n    character: Character,\n    allies: list\n): id? {\n    let critical_threshold = 0.3\n    let heal_threshold = 0.7\n    \n    // First, find critically wounded\n    for ally in allies {\n        let hp_pct = ally.Health.current / ally.Health.max\n        if hp_pct < critical_threshold {\n            return ally.id\n        }\n    }\n    \n    // Then, find anyone needing healing\n    for ally in allies {\n        let hp_pct = ally.Health.current / ally.Health.max\n        if hp_pct < heal_threshold {\n            return ally.id\n        }\n    }\n    \n    // No one needs healing\n    return null\n}\n\n// === TARGET SELECTION FOR ATTACKS ===\n\n// Cleric attacks lowest threat enemy\nchoice fn select_attack_target(\n    character: Character,\n    enemies: list\n): id {\n    let target = enemies[0]\n    let lowestThreat = 999999\n    \n    for enemy in enemies {\n        let threat = enemy.Combat.damage * (enemy.Health.current / enemy.Health.max)\n        if threat < lowestThreat {\n            target = enemy\n            lowestThreat = threat\n        }\n    }\n    \n    return target.id\n}\n",
        "language": "bcl"
      },
      {
        "path": "../../game/bcl/flee-aggressive.bcl",
        "content": "// Aggressive Flee Strategy for Classic RPG\n// Prioritizes speed - rarely flees, accepts death penalties\n\nmodule aggressive_flee\n\n// Helper: Count alive heroes\nfn count_alive_heroes(party: list): integer {\n    let count = 0\n    \n    for hero in party {\n        if hero.Health.current > 0 {\n            count += 1\n        }\n    }\n    \n    return count\n}\n\n// Aggressive flee decision - only flee when imminent TPK\n// Accepts death penalties for faster clear times\n// Best for: Strong builds, speedruns\n// Expected: Few retreats (0-3), more deaths (5-10)\nchoice fn should_flee_from_battle(\n    party: list,\n    enemies: list,\n    runStats: RunStats\n): boolean {\n    // Never flee if on cooldown\n    if !runStats.canFlee {\n        return false\n    }\n    \n    let alive_count = count_alive_heroes(party)\n    \n    // Only flee if down to 1 hero (about to wipe)\n    // Risk multiple deaths (50s each) to avoid retreat penalties (10s)\n    // Net positive if you can win fights without dying\n    if alive_count <= 1 {\n        return true\n    }\n    \n    return false\n}\n",
        "language": "bcl"
      },
      {
        "path": "../../game/bcl/flee-conservative.bcl",
        "content": "// Conservative Flee Strategy for Classic RPG\n// Prioritizes survival - flees early to minimize death penalties\n\nmodule conservative_flee\n\n// Helper: Calculate average party health percentage\nfn calculate_avg_party_health(party: list): float {\n    let total_health = 0.0\n    let total_max_health = 0.0\n    \n    for hero in party {\n        total_health += hero.Health.current\n        total_max_health += hero.Health.max\n    }\n    \n    if total_max_health == 0 {\n        return 0.0\n    }\n    \n    return total_health / total_max_health\n}\n\n// Conservative flee decision - retreat at 40% avg health\n// Minimizes death risk but incurs more flee penalties\n// Best for: Difficult content, learning phase\n// Expected: More retreats (10-15), fewer deaths (0-2)\nchoice fn should_flee_from_battle(\n    party: list,\n    enemies: list,\n    runStats: RunStats\n): boolean {\n    // Never flee if on cooldown\n    if !runStats.canFlee {\n        return false\n    }\n    \n    let avg_health = calculate_avg_party_health(party)\n    \n    // Conservative threshold - flee when average health drops below 40%\n    // This leaves a safety margin before deaths occur\n    if avg_health < 0.4 {\n        return true\n    }\n    \n    return false\n}\n",
        "language": "bcl"
      },
      {
        "path": "../../game/bcl/mage-skills.bcl",
        "content": "// Mage Skill Choices BCL\n// Defines skill selection strategy for the Mage class\n\nmodule mage_skills\n\n// === SKILL TREE DEFINITIONS ===\n// Tier 1 Skills (Level 2+)\n// - fireball: High damage single target spell (20 mana)\n// - ice_shard: Moderate damage with slow effect (15 mana)\n// - arcane_missiles: Fast casting multi-hit (10 mana)\n\n// Tier 2 Skills (Level 4+)\n// - blizzard: AoE damage to all enemies (40 mana)\n// - mana_shield: Convert damage to mana drain (25 mana)\n// - pyroblast: Very high single target damage (50 mana)\n\n// Tier 3 Skills (Level 7+)\n// - meteor: Massive AoE damage (80 mana)\n// - time_warp: Increase party attack speed (60 mana)\n// - arcane_explosion: Instant AoE around caster (45 mana)\n\n// === HELPER FUNCTIONS ===\n\nfn health_percentage(entity): float {\n    return entity.Health.current / entity.Health.max\n}\n\nfn mana_percentage(entity): float {\n    return entity.Mana.current / entity.Mana.max\n}\n\nfn can_cast(character, manaCost): boolean {\n    return character.Mana.current >= manaCost\n}\n\n// === SKILL CHOICE IMPLEMENTATION ===\n\n// Called when mage levels up and gains a skill point\nchoice fn select_skill_on_levelup(\n    character: Character & Skills,\n    currentLevel: number\n): string {\n    // At level 2, get fireball for damage\n    if currentLevel == 2 {\n        return \"fireball\"\n    }\n    \n    // At level 3, get ice shard for utility\n    if currentLevel == 3 {\n        return \"ice_shard\"\n    }\n    \n    // At level 4, get arcane missiles for mana efficiency\n    if currentLevel == 4 {\n        return \"arcane_missiles\"\n    }\n    \n    // At level 5, get blizzard for AoE\n    if currentLevel == 5 {\n        return \"blizzard\"\n    }\n    \n    // At level 6, get mana shield for survival\n    if currentLevel == 6 {\n        return \"mana_shield\"\n    }\n    \n    // At level 7+, get meteor for ultimate damage\n    if currentLevel >= 7 {\n        return \"meteor\"\n    }\n    \n    return \"fireball\"\n}\n\n// === COMBAT SKILL SELECTION ===\n\n// Called each combat round to select which skill to use\nchoice fn select_combat_skill(\n    character: Character & Skills & Health & Mana & Combat,\n    allies: list,\n    enemies: list\n): string {\n    let hp_pct = health_percentage(character)\n    let mana_pct = mana_percentage(character)\n    \n    // Emergency: If health is low and we have mana shield, use it\n    if hp_pct < 0.3 && mana_pct > 0.5 {\n        if character.Skills.skill3 == \"mana_shield\" {\n            return \"mana_shield\"\n        }\n    }\n    \n    // If we have meteor and enough mana, use it on groups\n    if enemies.count >= 2 && can_cast(character, 80) {\n        if character.Skills.skill4 == \"meteor\" {\n            return \"meteor\"\n        }\n    }\n    \n    // If multiple enemies and we have blizzard\n    if enemies.count >= 2 && can_cast(character, 40) {\n        if character.Skills.skill3 == \"blizzard\" {\n            return \"blizzard\"\n        }\n    }\n    \n    // High mana - use pyroblast or fireball\n    if mana_pct > 0.6 {\n        if can_cast(character, 50) && character.Skills.skill3 == \"pyroblast\" {\n            return \"pyroblast\"\n        }\n        if can_cast(character, 20) && character.Skills.skill1 == \"fireball\" {\n            return \"fireball\"\n        }\n    }\n    \n    // Medium mana - use ice shard\n    if mana_pct > 0.3 && can_cast(character, 15) {\n        if character.Skills.skill2 == \"ice_shard\" {\n            return \"ice_shard\"\n        }\n    }\n    \n    // Low mana - use arcane missiles (efficient)\n    if can_cast(character, 10) && character.Skills.skill2 == \"arcane_missiles\" {\n        return \"arcane_missiles\"\n    }\n    \n    // Very low mana - basic attack to conserve\n    return \"basic_attack\"\n}\n\n// === TARGET SELECTION ===\n\n// Mages prioritize low health targets to finish them off\nchoice fn select_attack_target(\n    character: Character,\n    enemies: list\n): id {\n    let target = enemies[0]\n    let lowestHealth = 999999\n    \n    // Find enemy with lowest current health\n    for enemy in enemies {\n        if enemy.Health.current < lowestHealth {\n            target = enemy\n            lowestHealth = enemy.Health.current\n        }\n    }\n    \n    return target.id\n}\n",
        "language": "bcl"
      },
      {
        "path": "../../game/bcl/party-config.bcl",
        "content": "// Party Configuration BCL\n// Complete party setup for Classic RPG\n\nmodule my_party\n\n// === PARTY COMPOSITION ===\n\nparty {\n    warrior {\n        name: \"Sir Braveheart\"\n        class: \"Warrior\"\n        stats {\n            strength: 16\n            dexterity: 10\n            intelligence: 8\n            constitution: 14\n            wisdom: 8\n        }\n        equipment {\n            weapon: \"longsword\"\n            armor: \"plate_mail\"\n            accessory: \"ring_of_protection\"\n        }\n    }\n    \n    mage {\n        name: \"Elara Flamecaster\"\n        class: \"Mage\"\n        stats {\n            strength: 6\n            dexterity: 12\n            intelligence: 18\n            constitution: 8\n            wisdom: 14\n        }\n        equipment {\n            weapon: \"staff_of_fire\"\n            armor: \"arcane_robes\"\n            accessory: \"amulet_of_mana\"\n        }\n    }\n    \n    rogue {\n        name: \"Shadow\"\n        class: \"Rogue\"\n        stats {\n            strength: 10\n            dexterity: 18\n            intelligence: 10\n            constitution: 10\n            wisdom: 8\n        }\n        equipment {\n            weapon: \"twin_daggers\"\n            armor: \"leather_armor\"\n            accessory: \"cloak_of_shadows\"\n        }\n    }\n    \n    cleric {\n        name: \"Brother Aldric\"\n        class: \"Cleric\"\n        stats {\n            strength: 10\n            dexterity: 8\n            intelligence: 12\n            constitution: 12\n            wisdom: 18\n        }\n        equipment {\n            weapon: \"holy_mace\"\n            armor: \"chainmail\"\n            accessory: \"holy_symbol\"\n        }\n    }\n}\n\n// === GLOBAL STRATEGY SETTINGS ===\n\nstrategy {\n    // When to use potions\n    potion_threshold: 0.3\n    \n    // When to flee - balanced strategy (30% avg party health)\n    flee_threshold: 0.3\n    \n    // Priority: survival > dps > utility\n    priority: \"balanced\"\n}\n\n// === FLEE DECISION LOGIC ===\n\n// Helper: Calculate average party health percentage\nfn calculate_avg_party_health(party: list): float {\n    let total_health = 0.0\n    let total_max_health = 0.0\n    \n    for hero in party {\n        total_health += hero.Health.current\n        total_max_health += hero.Health.max\n    }\n    \n    if total_max_health == 0 {\n        return 0.0\n    }\n    \n    return total_health / total_max_health\n}\n\n// Helper: Count alive heroes\nfn count_alive_heroes(party: list): integer {\n    let count = 0\n    \n    for hero in party {\n        if hero.Health.current > 0 {\n            count += 1\n        }\n    }\n    \n    return count\n}\n\n// Helper: Check if healer is alive\nfn has_alive_healer(party: list): boolean {\n    for hero in party {\n        if hero.Character.class == \"Cleric\" && hero.Health.current > 0 {\n            return true\n        }\n    }\n    return false\n}\n\n// Helper: Count alive enemies\nfn count_alive_enemies(enemies: list): integer {\n    let count = 0\n    \n    for enemy in enemies {\n        if enemy.Health.current > 0 {\n            count += 1\n        }\n    }\n    \n    return count\n}\n\n// Main flee decision - balanced strategy\n// Flees when party health is low to avoid death penalties (50s vs 10s)\nchoice fn should_flee_from_battle(\n    party: list,\n    enemies: list,\n    runStats: RunStats\n): boolean {\n    // Never flee if on cooldown\n    if !runStats.canFlee {\n        return false\n    }\n    \n    let avg_health = calculate_avg_party_health(party)\n    let alive_count = count_alive_heroes(party)\n    let enemy_count = count_alive_enemies(enemies)\n    let healer_alive = has_alive_healer(party)\n    \n    // Flee if average party health below 30% AND multiple enemies\n    // Math: Preventing 3+ deaths (150s) worth fleeing (10s)\n    if avg_health < 0.3 && enemy_count >= 3 {\n        return true\n    }\n    \n    // Flee if healer dead AND health below 50%\n    if !healer_alive && avg_health < 0.5 {\n        return true\n    }\n    \n    // Flee if down to 1 hero\n    if alive_count <= 1 {\n        return true\n    }\n    \n    return false\n}\n\n// === IMPORT CLASS-SPECIFIC STRATEGIES ===\n\nimport warrior_skills\nimport mage_skills\nimport rogue_skills\nimport cleric_skills\n\n// === GLOBAL TARGET SELECTION ===\n\n// Priority targeting based on enemy type\nfn enemy_priority(enemy: Character & Enemy): number {\n    // Bosses are high priority\n    if enemy.Enemy.isBoss {\n        return 100\n    }\n    \n    // Higher tier enemies are more dangerous\n    return enemy.Enemy.tier * 20\n}\n\n// Global target selection - focus fire on priority targets\nchoice fn select_party_target(\n    allies: list,\n    enemies: list\n): id {\n    let target = enemies[0]\n    let highestPriority = 0\n    \n    for enemy in enemies {\n        let priority = enemy_priority(enemy)\n        \n        // Add bonus for low health enemies (finish them off)\n        let hp_pct = enemy.Health.current / enemy.Health.max\n        if hp_pct < 0.3 {\n            priority = priority + 50\n        }\n        \n        if priority > highestPriority {\n            target = enemy\n            highestPriority = priority\n        }\n    }\n    \n    return target.id\n}\n",
        "language": "bcl"
      },
      {
        "path": "../../game/bcl/rogue-skills.bcl",
        "content": "// Rogue Skill Choices BCL\n// Defines skill selection strategy for the Rogue class\n\nmodule rogue_skills\n\n// === SKILL TREE DEFINITIONS ===\n// Tier 1 Skills (Level 2+)\n// - backstab: High crit chance attack\n// - poison_blade: DoT damage over time\n// - quick_slash: Very fast attack\n\n// Tier 2 Skills (Level 4+)\n// - shadowstep: Teleport behind enemy, guaranteed crit\n// - fan_of_knives: AoE damage to all enemies\n// - evasion: Greatly increase dodge chance\n\n// Tier 3 Skills (Level 7+)\n// - assassinate: Instant kill on low HP targets\n// - smoke_bomb: Become untargetable briefly\n// - blade_flurry: Attack all enemies rapidly\n\n// === HELPER FUNCTIONS ===\n\nfn health_percentage(entity): float {\n    return entity.Health.current / entity.Health.max\n}\n\nfn is_stealthed(character): boolean {\n    return character.Buffs.hasteBonus > 0.5\n}\n\n// === SKILL CHOICE IMPLEMENTATION ===\n\n// Called when rogue levels up and gains a skill point\nchoice fn select_skill_on_levelup(\n    character: Character & Skills,\n    currentLevel: number\n): string {\n    // At level 2, get backstab for crits\n    if currentLevel == 2 {\n        return \"backstab\"\n    }\n    \n    // At level 3, get poison blade for sustained damage\n    if currentLevel == 3 {\n        return \"poison_blade\"\n    }\n    \n    // At level 4, get quick slash for speed\n    if currentLevel == 4 {\n        return \"quick_slash\"\n    }\n    \n    // At level 5, get shadowstep for burst damage\n    if currentLevel == 5 {\n        return \"shadowstep\"\n    }\n    \n    // At level 6, get evasion for survival\n    if currentLevel == 6 {\n        return \"evasion\"\n    }\n    \n    // At level 7+, get assassinate for execution\n    if currentLevel >= 7 {\n        return \"assassinate\"\n    }\n    \n    return \"backstab\"\n}\n\n// === COMBAT SKILL SELECTION ===\n\n// Called each combat round to select which skill to use\nchoice fn select_combat_skill(\n    character: Character & Skills & Health & Combat,\n    allies: list,\n    enemies: list\n): string {\n    let hp_pct = health_percentage(character)\n    \n    // Emergency survival: Use evasion or smoke bomb\n    if hp_pct < 0.25 {\n        if character.Skills.skill3 == \"evasion\" {\n            return \"evasion\"\n        }\n        if character.Skills.skill4 == \"smoke_bomb\" {\n            return \"smoke_bomb\"\n        }\n    }\n    \n    // Check for assassinate opportunity\n    if character.Skills.skill4 == \"assassinate\" {\n        for enemy in enemies {\n            let enemy_hp_pct = enemy.Health.current / enemy.Health.max\n            if enemy_hp_pct < 0.15 {\n                return \"assassinate\"\n            }\n        }\n    }\n    \n    // Multiple enemies - use fan of knives or blade flurry\n    if enemies.count >= 3 {\n        if character.Skills.skill4 == \"blade_flurry\" {\n            return \"blade_flurry\"\n        }\n        if character.Skills.skill3 == \"fan_of_knives\" {\n            return \"fan_of_knives\"\n        }\n    }\n    \n    // Shadowstep for burst damage on single target\n    if enemies.count == 1 {\n        if character.Skills.skill3 == \"shadowstep\" {\n            return \"shadowstep\"\n        }\n    }\n    \n    // Default rotation: backstab > poison > quick slash\n    if character.Skills.skill1 == \"backstab\" {\n        return \"backstab\"\n    }\n    if character.Skills.skill2 == \"poison_blade\" {\n        return \"poison_blade\"\n    }\n    if character.Skills.skill2 == \"quick_slash\" {\n        return \"quick_slash\"\n    }\n    \n    return \"basic_attack\"\n}\n\n// === TARGET SELECTION ===\n\n// Rogues prioritize squishy high-damage targets (mages, healers)\nchoice fn select_attack_target(\n    character: Character,\n    enemies: list\n): id {\n    let target = enemies[0]\n    let highestPriority = 0\n    \n    for enemy in enemies {\n        let priority = 0\n        \n        // Prioritize low defense targets\n        if enemy.Combat.defense < 5 {\n            priority = priority + 50\n        }\n        \n        // Prioritize high damage targets\n        priority = priority + enemy.Combat.damage\n        \n        // Prioritize low health targets\n        let hp_pct = enemy.Health.current / enemy.Health.max\n        if hp_pct < 0.3 {\n            priority = priority + 100\n        }\n        \n        if priority > highestPriority {\n            target = enemy\n            highestPriority = priority\n        }\n    }\n    \n    return target.id\n}\n",
        "language": "bcl"
      },
      {
        "path": "../../game/bcl/warrior-skills.bcl",
        "content": "// Warrior Skill Choices BCL\n// Defines skill selection strategy for the Warrior class\n\nmodule warrior_skills\n\n// === SKILL TREE DEFINITIONS ===\n// Tier 1 Skills (Level 2+)\n// - power_strike: Increased damage on next attack\n// - shield_bash: Stuns enemy briefly\n// - defensive_stance: Increases defense\n\n// Tier 2 Skills (Level 4+)\n// - cleave: Attack hits multiple enemies\n// - battle_cry: Increases party damage\n// - iron_skin: Temporary damage reduction\n\n// Tier 3 Skills (Level 7+)\n// - execute: High damage to low HP enemies\n// - rally: Heal and buff nearby allies\n// - berserker_rage: Massive damage but lower defense\n\n// === HELPER FUNCTIONS ===\n\nfn health_percentage(character): float {\n    return character.Health.current / character.Health.max\n}\n\nfn has_skill_points(character): boolean {\n    return character.Skills.skillPoints > 0\n}\n\n// === SKILL CHOICE IMPLEMENTATION ===\n\n// Called when warrior levels up and gains a skill point\nchoice fn select_skill_on_levelup(\n    character: Character & Skills,\n    currentLevel: number\n): string {\n    // At level 2, choose first tier 1 skill\n    if currentLevel == 2 {\n        return \"power_strike\"\n    }\n    \n    // At level 3, choose second tier 1 skill\n    if currentLevel == 3 {\n        return \"shield_bash\"\n    }\n    \n    // At level 4, choose defensive stance\n    if currentLevel == 4 {\n        return \"defensive_stance\"\n    }\n    \n    // At level 5, choose tier 2 skill - cleave for damage\n    if currentLevel == 5 {\n        return \"cleave\"\n    }\n    \n    // At level 6, choose battle cry for party buff\n    if currentLevel == 6 {\n        return \"battle_cry\"\n    }\n    \n    // At level 7+, choose tier 3 skill based on playstyle\n    if currentLevel >= 7 {\n        // Offensive warrior goes for execute\n        return \"execute\"\n    }\n    \n    return \"power_strike\"\n}\n\n// === COMBAT SKILL SELECTION ===\n\n// Called each combat round to select which skill to use\nchoice fn select_combat_skill(\n    character: Character & Skills & Health & Combat,\n    allies: list,\n    enemies: list\n): string {\n    let hp_pct = health_percentage(character)\n    \n    // If health is very low, use defensive abilities\n    if hp_pct < 0.25 {\n        if character.Skills.skill3 == \"defensive_stance\" {\n            return \"defensive_stance\"\n        }\n        if character.Skills.skill2 == \"shield_bash\" {\n            return \"shield_bash\"\n        }\n    }\n    \n    // If we have execute and enemy is low, use it\n    if character.Skills.skill4 != \"\" {\n        for enemy in enemies {\n            let enemy_hp_pct = enemy.Health.current / enemy.Health.max\n            if enemy_hp_pct < 0.2 {\n                return \"execute\"\n            }\n        }\n    }\n    \n    // If multiple enemies and we have cleave, use it\n    if enemies.count >= 2 {\n        if character.Skills.skill3 == \"cleave\" {\n            return \"cleave\"\n        }\n    }\n    \n    // Default to power strike for damage\n    if character.Skills.skill1 == \"power_strike\" {\n        return \"power_strike\"\n    }\n    \n    return \"basic_attack\"\n}\n\n// === TARGET SELECTION ===\n\n// Warriors prefer to attack the strongest enemy\nchoice fn select_attack_target(\n    character: Character,\n    enemies: list\n): id {\n    let target = enemies[0]\n    let highestDamage = 0\n    \n    // Find enemy with highest damage (threat)\n    for enemy in enemies {\n        if enemy.Combat.damage > highestDamage {\n            target = enemy\n            highestDamage = enemy.Combat.damage\n        }\n    }\n    \n    return target.id\n}\n",
        "language": "bcl"
      }
    ]
  }
}