{
  "version": "1.0",
  "module": "unnamed",
  "metadata": {
    "compiled_at": "2026-01-18T21:28:57Z",
    "compiler_version": "0.1.0"
  },
  "components": [
    {
      "id": 0,
      "name": "Character",
      "fields": [
        {
          "name": "name",
          "type": {
            "type": "string"
          }
        },
        {
          "name": "class",
          "type": {
            "type": "string"
          }
        },
        {
          "name": "level",
          "type": {
            "type": "number"
          }
        },
        {
          "name": "experience",
          "type": {
            "type": "number"
          }
        },
        {
          "name": "experienceToLevel",
          "type": {
            "type": "number"
          }
        }
      ]
    },
    {
      "id": 1,
      "name": "Health",
      "fields": [
        {
          "name": "current",
          "type": {
            "type": "number"
          }
        },
        {
          "name": "max",
          "type": {
            "type": "number"
          }
        }
      ]
    },
    {
      "id": 2,
      "name": "Mana",
      "fields": [
        {
          "name": "current",
          "type": {
            "type": "number"
          }
        },
        {
          "name": "max",
          "type": {
            "type": "number"
          }
        }
      ]
    },
    {
      "id": 3,
      "name": "Stats",
      "fields": [
        {
          "name": "strength",
          "type": {
            "type": "number"
          }
        },
        {
          "name": "dexterity",
          "type": {
            "type": "number"
          }
        },
        {
          "name": "intelligence",
          "type": {
            "type": "number"
          }
        },
        {
          "name": "constitution",
          "type": {
            "type": "number"
          }
        },
        {
          "name": "wisdom",
          "type": {
            "type": "number"
          }
        }
      ]
    },
    {
      "id": 4,
      "name": "Combat",
      "fields": [
        {
          "name": "damage",
          "type": {
            "type": "number"
          }
        },
        {
          "name": "defense",
          "type": {
            "type": "number"
          }
        },
        {
          "name": "attackSpeed",
          "type": {
            "type": "number"
          }
        },
        {
          "name": "critChance",
          "type": {
            "type": "number"
          }
        },
        {
          "name": "critMultiplier",
          "type": {
            "type": "number"
          }
        }
      ]
    },
    {
      "id": 5,
      "name": "Target",
      "fields": [
        {
          "name": "entity",
          "type": {
            "type": "entity"
          }
        }
      ]
    },
    {
      "id": 6,
      "name": "Team",
      "fields": [
        {
          "name": "id",
          "type": {
            "type": "string"
          }
        },
        {
          "name": "isPlayer",
          "type": {
            "type": "boolean"
          }
        }
      ]
    },
    {
      "id": 7,
      "name": "Enemy",
      "fields": [
        {
          "name": "tier",
          "type": {
            "type": "number"
          }
        },
        {
          "name": "isBoss",
          "type": {
            "type": "boolean"
          }
        },
        {
          "name": "expReward",
          "type": {
            "type": "number"
          }
        }
      ]
    },
    {
      "id": 8,
      "name": "EnemyCompendium",
      "fields": [
        {
          "name": "entries",
          "type": {
            "type": "list",
            "element": {
              "type": "entity"
            }
          }
        }
      ]
    },
    {
      "id": 9,
      "name": "Skills",
      "fields": [
        {
          "name": "skill1",
          "type": {
            "type": "string"
          }
        },
        {
          "name": "skill2",
          "type": {
            "type": "string"
          }
        },
        {
          "name": "skill3",
          "type": {
            "type": "string"
          }
        },
        {
          "name": "skill4",
          "type": {
            "type": "string"
          }
        },
        {
          "name": "skillPoints",
          "type": {
            "type": "number"
          }
        }
      ]
    },
    {
      "id": 10,
      "name": "Buffs",
      "fields": [
        {
          "name": "damageBonus",
          "type": {
            "type": "number"
          }
        },
        {
          "name": "defenseBonus",
          "type": {
            "type": "number"
          }
        },
        {
          "name": "hasteBonus",
          "type": {
            "type": "number"
          }
        },
        {
          "name": "shieldAmount",
          "type": {
            "type": "number"
          }
        },
        {
          "name": "regenAmount",
          "type": {
            "type": "number"
          }
        }
      ]
    },
    {
      "id": 11,
      "name": "GameState",
      "fields": [
        {
          "name": "currentWave",
          "type": {
            "type": "number"
          }
        },
        {
          "name": "enemiesDefeated",
          "type": {
            "type": "number"
          }
        },
        {
          "name": "playerDeaths",
          "type": {
            "type": "number"
          }
        },
        {
          "name": "bossDefeated",
          "type": {
            "type": "boolean"
          }
        },
        {
          "name": "gameOver",
          "type": {
            "type": "boolean"
          }
        },
        {
          "name": "victory",
          "type": {
            "type": "boolean"
          }
        },
        {
          "name": "retargetingActive",
          "type": {
            "type": "boolean"
          }
        }
      ]
    },
    {
      "id": 12,
      "name": "RunStats",
      "fields": [
        {
          "name": "simulationTime",
          "type": {
            "type": "number"
          }
        },
        {
          "name": "retreatCount",
          "type": {
            "type": "number"
          }
        },
        {
          "name": "retreatPenalty",
          "type": {
            "type": "number"
          }
        },
        {
          "name": "deathPenalty",
          "type": {
            "type": "number"
          }
        },
        {
          "name": "totalTime",
          "type": {
            "type": "number"
          }
        },
        {
          "name": "canFlee",
          "type": {
            "type": "boolean"
          }
        },
        {
          "name": "lastFleeTime",
          "type": {
            "type": "number"
          }
        }
      ]
    },
    {
      "id": 13,
      "name": "FleeConfig",
      "fields": [
        {
          "name": "retreatTimePenalty",
          "type": {
            "type": "number"
          }
        },
        {
          "name": "deathTimePenaltyMultiplier",
          "type": {
            "type": "number"
          }
        },
        {
          "name": "fleeCooldown",
          "type": {
            "type": "number"
          }
        }
      ]
    },
    {
      "id": 14,
      "name": "SkillCooldown",
      "fields": [
        {
          "name": "skill1Cooldown",
          "type": {
            "type": "number"
          }
        },
        {
          "name": "skill2Cooldown",
          "type": {
            "type": "number"
          }
        },
        {
          "name": "skill3Cooldown",
          "type": {
            "type": "number"
          }
        },
        {
          "name": "skill4Cooldown",
          "type": {
            "type": "number"
          }
        }
      ]
    },
    {
      "id": 15,
      "name": "ChoiceContext",
      "fields": [
        {
          "name": "pendingChoice",
          "type": {
            "type": "string"
          }
        },
        {
          "name": "options",
          "type": {
            "type": "string"
          }
        },
        {
          "name": "chosen",
          "type": {
            "type": "string"
          }
        }
      ]
    },
    {
      "id": 16,
      "name": "HeroInfo",
      "fields": [
        {
          "name": "id",
          "type": {
            "type": "string"
          }
        },
        {
          "name": "description",
          "type": {
            "type": "string"
          }
        },
        {
          "name": "difficulty",
          "type": {
            "type": "string"
          }
        },
        {
          "name": "role",
          "type": {
            "type": "string"
          }
        },
        {
          "name": "playstyle",
          "type": {
            "type": "string"
          }
        }
      ]
    },
    {
      "id": 17,
      "name": "SpawnConfig",
      "fields": [
        {
          "name": "bossEveryKills",
          "type": {
            "type": "number"
          }
        },
        {
          "name": "tierProgressionKills",
          "type": {
            "type": "number"
          }
        },
        {
          "name": "maxTier",
          "type": {
            "type": "number"
          }
        },
        {
          "name": "healthScaleRate",
          "type": {
            "type": "number"
          }
        },
        {
          "name": "damageScaleRate",
          "type": {
            "type": "number"
          }
        },
        {
          "name": "initialEnemyCount",
          "type": {
            "type": "number"
          }
        }
      ]
    }
  ],
  "rules": [
    {
      "id": 0,
      "name": "attack_rule",
      "trigger": {
        "type": "event",
        "event": "DoAttack"
      },
      "actions": [
        {
          "type": "conditional",
          "condition": {
            "type": "binary",
            "op": "and",
            "left": {
              "type": "binary",
              "op": "neq",
              "left": {
                "type": "field",
                "entity": "entity",
                "component": "Target",
                "field": "entity"
              },
              "right": {
                "type": "literal",
                "value": null
              }
            },
            "right": {
              "type": "binary",
              "op": "gt",
              "left": {
                "type": "field",
                "entity": "entity",
                "component": "Health",
                "field": "current"
              },
              "right": {
                "type": "literal",
                "value": 0.0
              }
            }
          },
          "then_actions": [
            {
              "type": "modify",
              "entity": {
                "type": "var",
                "name": "target"
              },
              "component": "Health",
              "field": "current",
              "op": "subtract",
              "value": {
                "type": "var",
                "name": "damage"
              }
            },
            {
              "type": "schedule",
              "event": "AfterAttack",
              "fields": {
                "attacker": {
                  "type": "var",
                  "name": "id"
                },
                "target": {
                  "type": "var",
                  "name": "id"
                }
              }
            },
            {
              "type": "schedule",
              "event": "DoAttack",
              "delay": {
                "type": "var",
                "name": "delay"
              },
              "fields": {
                "source": {
                  "type": "var",
                  "name": "id"
                }
              }
            }
          ]
        }
      ]
    },
    {
      "id": 1,
      "name": "death_check",
      "trigger": {
        "type": "event",
        "event": "AfterAttack"
      },
      "actions": [
        {
          "type": "conditional",
          "condition": {
            "type": "binary",
            "op": "lte",
            "left": {
              "type": "field",
              "entity": "entity",
              "component": "Health",
              "field": "current"
            },
            "right": {
              "type": "literal",
              "value": 0.0
            }
          },
          "then_actions": [
            {
              "type": "schedule",
              "event": "Death",
              "fields": {
                "target": {
                  "type": "var",
                  "name": "id"
                }
              }
            }
          ]
        }
      ]
    },
    {
      "id": 2,
      "name": "enemy_death_handler",
      "trigger": {
        "type": "event",
        "event": "Death"
      },
      "actions": [
        {
          "type": "conditional",
          "condition": {
            "type": "binary",
            "op": "and",
            "left": {
              "type": "binary",
              "op": "gt",
              "left": {
                "type": "field",
                "entity": "entity",
                "component": "Enemy",
                "field": "tier"
              },
              "right": {
                "type": "literal",
                "value": 0.0
              }
            },
            "right": {
              "type": "binary",
              "op": "lte",
              "left": {
                "type": "field",
                "entity": "entity",
                "component": "Health",
                "field": "current"
              },
              "right": {
                "type": "literal",
                "value": 0.0
              }
            }
          },
          "then_actions": [
            {
              "type": "schedule",
              "event": "EnemyDefeated",
              "fields": {
                "enemy": {
                  "type": "var",
                  "name": "id"
                },
                "expReward": {
                  "type": "field",
                  "entity": "entity",
                  "component": "Enemy",
                  "field": "expReward"
                },
                "isBoss": {
                  "type": "field",
                  "entity": "entity",
                  "component": "Enemy",
                  "field": "isBoss"
                }
              }
            }
          ]
        }
      ]
    },
    {
      "id": 3,
      "name": "player_death_handler",
      "trigger": {
        "type": "event",
        "event": "Death"
      },
      "actions": [
        {
          "type": "conditional",
          "condition": {
            "type": "binary",
            "op": "and",
            "left": {
              "type": "field",
              "entity": "entity",
              "component": "Team",
              "field": "isPlayer"
            },
            "right": {
              "type": "binary",
              "op": "lte",
              "left": {
                "type": "field",
                "entity": "entity",
                "component": "Health",
                "field": "current"
              },
              "right": {
                "type": "literal",
                "value": 0.0
              }
            }
          },
          "then_actions": [
            {
              "type": "schedule",
              "event": "PlayerDefeated",
              "fields": {
                "player": {
                  "type": "var",
                  "name": "id"
                }
              }
            }
          ]
        }
      ]
    },
    {
      "id": 4,
      "name": "grant_experience",
      "trigger": {
        "type": "event",
        "event": "EnemyDefeated"
      },
      "actions": [
        {
          "type": "conditional",
          "condition": {
            "type": "field",
            "entity": "entity",
            "component": "Team",
            "field": "isPlayer"
          },
          "then_actions": [
            {
              "type": "modify",
              "entity": {
                "type": "var",
                "name": "entity"
              },
              "component": "Character",
              "field": "experience",
              "op": "add",
              "value": {
                "type": "literal",
                "value": 50.0
              }
            },
            {
              "type": "schedule",
              "event": "CheckLevelUp",
              "fields": {
                "source": {
                  "type": "var",
                  "name": "id"
                }
              }
            }
          ]
        }
      ]
    },
    {
      "id": 5,
      "name": "level_up_check",
      "trigger": {
        "type": "event",
        "event": "CheckLevelUp"
      },
      "actions": [
        {
          "type": "conditional",
          "condition": {
            "type": "binary",
            "op": "gte",
            "left": {
              "type": "field",
              "entity": "entity",
              "component": "Character",
              "field": "experience"
            },
            "right": {
              "type": "field",
              "entity": "entity",
              "component": "Character",
              "field": "experienceToLevel"
            }
          },
          "then_actions": [
            {
              "type": "modify",
              "entity": {
                "type": "var",
                "name": "entity"
              },
              "component": "Character",
              "field": "level",
              "op": "add",
              "value": {
                "type": "literal",
                "value": 1.0
              }
            },
            {
              "type": "modify",
              "entity": {
                "type": "var",
                "name": "entity"
              },
              "component": "Character",
              "field": "experience",
              "op": "subtract",
              "value": {
                "type": "field",
                "entity": "entity",
                "component": "Character",
                "field": "experienceToLevel"
              }
            },
            {
              "type": "modify",
              "entity": {
                "type": "var",
                "name": "entity"
              },
              "component": "Character",
              "field": "experienceToLevel",
              "op": "multiply",
              "value": {
                "type": "literal",
                "value": 1.5
              }
            },
            {
              "type": "modify",
              "entity": {
                "type": "var",
                "name": "entity"
              },
              "component": "Skills",
              "field": "skillPoints",
              "op": "add",
              "value": {
                "type": "literal",
                "value": 1.0
              }
            },
            {
              "type": "schedule",
              "event": "LevelUp",
              "fields": {
                "source": {
                  "type": "var",
                  "name": "id"
                }
              }
            },
            {
              "type": "schedule",
              "event": "SkillChoice",
              "fields": {
                "source": {
                  "type": "var",
                  "name": "id"
                }
              }
            }
          ]
        }
      ]
    },
    {
      "id": 6,
      "name": "level_up_stats",
      "trigger": {
        "type": "event",
        "event": "LevelUp"
      },
      "actions": [
        {
          "type": "modify",
          "entity": {
            "type": "var",
            "name": "entity"
          },
          "component": "Health",
          "field": "max",
          "op": "add",
          "value": {
            "type": "literal",
            "value": 10.0
          }
        },
        {
          "type": "modify",
          "entity": {
            "type": "var",
            "name": "entity"
          },
          "component": "Health",
          "field": "current",
          "op": "add",
          "value": {
            "type": "literal",
            "value": 10.0
          }
        },
        {
          "type": "modify",
          "entity": {
            "type": "var",
            "name": "entity"
          },
          "component": "Combat",
          "field": "damage",
          "op": "add",
          "value": {
            "type": "literal",
            "value": 2.0
          }
        },
        {
          "type": "modify",
          "entity": {
            "type": "var",
            "name": "entity"
          },
          "component": "Combat",
          "field": "defense",
          "op": "add",
          "value": {
            "type": "literal",
            "value": 1.0
          }
        }
      ]
    },
    {
      "id": 7,
      "name": "boss_defeated_victory",
      "trigger": {
        "type": "event",
        "event": "EnemyDefeated"
      },
      "actions": [
        {
          "type": "modify",
          "entity": {
            "type": "var",
            "name": "entity"
          },
          "component": "GameState",
          "field": "enemiesDefeated",
          "op": "add",
          "value": {
            "type": "literal",
            "value": 1.0
          }
        },
        {
          "type": "schedule",
          "event": "CheckVictory"
        }
      ]
    },
    {
      "id": 8,
      "name": "use_skill_power_strike",
      "trigger": {
        "type": "event",
        "event": "UseSkill"
      },
      "actions": [
        {
          "type": "conditional",
          "condition": {
            "type": "binary",
            "op": "eq",
            "left": {
              "type": "field",
              "entity": "entity",
              "component": "Skills",
              "field": "skill1"
            },
            "right": {
              "type": "literal",
              "value": "power_strike"
            }
          },
          "then_actions": [
            {
              "type": "modify",
              "entity": {
                "type": "var",
                "name": "entity"
              },
              "component": "Buffs",
              "field": "damageBonus",
              "op": "add",
              "value": {
                "type": "literal",
                "value": 5.0
              }
            }
          ]
        }
      ]
    },
    {
      "id": 9,
      "name": "use_skill_fireball",
      "trigger": {
        "type": "event",
        "event": "UseSkill"
      },
      "actions": [
        {
          "type": "conditional",
          "condition": {
            "type": "binary",
            "op": "and",
            "left": {
              "type": "binary",
              "op": "eq",
              "left": {
                "type": "field",
                "entity": "entity",
                "component": "Skills",
                "field": "skill1"
              },
              "right": {
                "type": "literal",
                "value": "fireball"
              }
            },
            "right": {
              "type": "binary",
              "op": "gte",
              "left": {
                "type": "field",
                "entity": "entity",
                "component": "Mana",
                "field": "current"
              },
              "right": {
                "type": "literal",
                "value": 20.0
              }
            }
          },
          "then_actions": [
            {
              "type": "modify",
              "entity": {
                "type": "var",
                "name": "entity"
              },
              "component": "Mana",
              "field": "current",
              "op": "subtract",
              "value": {
                "type": "literal",
                "value": 20.0
              }
            },
            {
              "type": "modify",
              "entity": {
                "type": "var",
                "name": "entity"
              },
              "component": "Buffs",
              "field": "damageBonus",
              "op": "add",
              "value": {
                "type": "literal",
                "value": 15.0
              }
            }
          ]
        }
      ]
    },
    {
      "id": 10,
      "name": "use_skill_heal",
      "trigger": {
        "type": "event",
        "event": "UseSkill"
      },
      "actions": [
        {
          "type": "conditional",
          "condition": {
            "type": "binary",
            "op": "and",
            "left": {
              "type": "binary",
              "op": "eq",
              "left": {
                "type": "field",
                "entity": "entity",
                "component": "Skills",
                "field": "skill1"
              },
              "right": {
                "type": "literal",
                "value": "heal"
              }
            },
            "right": {
              "type": "binary",
              "op": "gte",
              "left": {
                "type": "field",
                "entity": "entity",
                "component": "Mana",
                "field": "current"
              },
              "right": {
                "type": "literal",
                "value": 15.0
              }
            }
          },
          "then_actions": [
            {
              "type": "modify",
              "entity": {
                "type": "var",
                "name": "entity"
              },
              "component": "Mana",
              "field": "current",
              "op": "subtract",
              "value": {
                "type": "literal",
                "value": 15.0
              }
            },
            {
              "type": "modify",
              "entity": {
                "type": "var",
                "name": "entity"
              },
              "component": "Health",
              "field": "current",
              "op": "add",
              "value": {
                "type": "literal",
                "value": 30.0
              }
            }
          ]
        }
      ]
    },
    {
      "id": 11,
      "name": "use_skill_backstab",
      "trigger": {
        "type": "event",
        "event": "UseSkill"
      },
      "actions": [
        {
          "type": "conditional",
          "condition": {
            "type": "binary",
            "op": "eq",
            "left": {
              "type": "field",
              "entity": "entity",
              "component": "Skills",
              "field": "skill1"
            },
            "right": {
              "type": "literal",
              "value": "backstab"
            }
          },
          "then_actions": [
            {
              "type": "modify",
              "entity": {
                "type": "var",
                "name": "entity"
              },
              "component": "Combat",
              "field": "critChance",
              "op": "add",
              "value": {
                "type": "literal",
                "value": 0.25
              }
            }
          ]
        }
      ]
    },
    {
      "id": 12,
      "name": "mana_regen",
      "trigger": {
        "type": "event",
        "event": "ManaRegen"
      },
      "actions": [
        {
          "type": "conditional",
          "condition": {
            "type": "binary",
            "op": "gt",
            "left": {
              "type": "field",
              "entity": "entity",
              "component": "Health",
              "field": "current"
            },
            "right": {
              "type": "literal",
              "value": 0.0
            }
          },
          "then_actions": [
            {
              "type": "modify",
              "entity": {
                "type": "var",
                "name": "entity"
              },
              "component": "Mana",
              "field": "current",
              "op": "add",
              "value": {
                "type": "literal",
                "value": 5.0
              }
            },
            {
              "type": "schedule",
              "event": "ManaRegen",
              "delay": {
                "type": "literal",
                "value": 2.0
              },
              "fields": {
                "source": {
                  "type": "var",
                  "name": "id"
                }
              }
            }
          ]
        }
      ]
    },
    {
      "id": 13,
      "name": "spawn_next_enemy",
      "trigger": {
        "type": "event",
        "event": "SpawnEnemy"
      },
      "actions": [
        {
          "type": "conditional",
          "condition": {
            "type": "binary",
            "op": "and",
            "left": {
              "type": "binary",
              "op": "eq",
              "left": {
                "type": "field",
                "entity": "entity",
                "component": "GameState",
                "field": "bossDefeated"
              },
              "right": {
                "type": "literal",
                "value": false
              }
            },
            "right": {
              "type": "binary",
              "op": "eq",
              "left": {
                "type": "field",
                "entity": "entity",
                "component": "GameState",
                "field": "gameOver"
              },
              "right": {
                "type": "literal",
                "value": false
              }
            }
          },
          "then_actions": [
            {
              "type": "conditional",
              "condition": {
                "type": "binary",
                "op": "or",
                "left": {
                  "type": "binary",
                  "op": "lt",
                  "left": {
                    "type": "field",
                    "entity": "entity",
                    "component": "GameState",
                    "field": "currentWave"
                  },
                  "right": {
                    "type": "literal",
                    "value": 4.0
                  }
                },
                "right": {
                  "type": "binary",
                  "op": "gte",
                  "left": {
                    "type": "field",
                    "entity": "entity",
                    "component": "GameState",
                    "field": "enemiesDefeated"
                  },
                  "right": {
                    "type": "literal",
                    "value": 2000.0
                  }
                }
              },
              "then_actions": [
                {
                  "type": "modify",
                  "entity": {
                    "type": "var",
                    "name": "entity"
                  },
                  "component": "GameState",
                  "field": "currentWave",
                  "op": "add",
                  "value": {
                    "type": "literal",
                    "value": 1.0
                  }
                },
                {
                  "type": "schedule",
                  "event": "EnemySpawned",
                  "fields": {
                    "wave": {
                      "type": "field",
                      "entity": "entity",
                      "component": "GameState",
                      "field": "currentWave"
                    }
                  }
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "id": 14,
      "name": "count_player_death",
      "trigger": {
        "type": "event",
        "event": "PlayerDefeated"
      },
      "actions": [
        {
          "type": "modify",
          "entity": {
            "type": "var",
            "name": "entity"
          },
          "component": "GameState",
          "field": "playerDeaths",
          "op": "add",
          "value": {
            "type": "literal",
            "value": 1.0
          }
        }
      ]
    },
    {
      "id": 15,
      "name": "apply_death_penalty",
      "trigger": {
        "type": "event",
        "event": "PlayerDefeated"
      },
      "actions": [
        {
          "type": "modify",
          "entity": {
            "type": "var",
            "name": "entity"
          },
          "component": "RunStats",
          "field": "deathPenalty",
          "op": "add",
          "value": {
            "type": "binary",
            "op": "multiply",
            "left": {
              "type": "field",
              "entity": "entity",
              "component": "FleeConfig",
              "field": "retreatTimePenalty"
            },
            "right": {
              "type": "field",
              "entity": "entity",
              "component": "FleeConfig",
              "field": "deathTimePenaltyMultiplier"
            }
          }
        },
        {
          "type": "modify",
          "entity": {
            "type": "var",
            "name": "entity"
          },
          "component": "RunStats",
          "field": "totalTime",
          "op": "set",
          "value": {
            "type": "binary",
            "op": "add",
            "left": {
              "type": "binary",
              "op": "add",
              "left": {
                "type": "field",
                "entity": "entity",
                "component": "RunStats",
                "field": "simulationTime"
              },
              "right": {
                "type": "field",
                "entity": "entity",
                "component": "RunStats",
                "field": "retreatPenalty"
              }
            },
            "right": {
              "type": "field",
              "entity": "entity",
              "component": "RunStats",
              "field": "deathPenalty"
            }
          }
        },
        {
          "type": "schedule",
          "event": "UpdateRunStats"
        }
      ]
    },
    {
      "id": 16,
      "name": "game_over_check",
      "trigger": {
        "type": "event",
        "event": "PlayerDefeated"
      },
      "actions": [
        {
          "type": "modify",
          "entity": {
            "type": "var",
            "name": "entity"
          },
          "component": "GameState",
          "field": "gameOver",
          "op": "set",
          "value": {
            "type": "literal",
            "value": true
          }
        },
        {
          "type": "schedule",
          "event": "GameOver",
          "fields": {
            "victory": {
              "type": "literal",
              "value": false
            }
          }
        }
      ]
    },
    {
      "id": 17,
      "name": "victory_check",
      "trigger": {
        "type": "event",
        "event": "CheckVictory"
      },
      "actions": [
        {
          "type": "conditional",
          "condition": {
            "type": "binary",
            "op": "gte",
            "left": {
              "type": "field",
              "entity": "entity",
              "component": "GameState",
              "field": "enemiesDefeated"
            },
            "right": {
              "type": "literal",
              "value": 5.0
            }
          },
          "then_actions": [
            {
              "type": "modify",
              "entity": {
                "type": "var",
                "name": "entity"
              },
              "component": "GameState",
              "field": "bossDefeated",
              "op": "set",
              "value": {
                "type": "literal",
                "value": true
              }
            },
            {
              "type": "modify",
              "entity": {
                "type": "var",
                "name": "entity"
              },
              "component": "GameState",
              "field": "victory",
              "op": "set",
              "value": {
                "type": "literal",
                "value": true
              }
            },
            {
              "type": "modify",
              "entity": {
                "type": "var",
                "name": "entity"
              },
              "component": "GameState",
              "field": "gameOver",
              "op": "set",
              "value": {
                "type": "literal",
                "value": true
              }
            },
            {
              "type": "schedule",
              "event": "GameOver",
              "fields": {
                "victory": {
                  "type": "literal",
                  "value": true
                }
              }
            }
          ]
        }
      ]
    },
    {
      "id": 18,
      "name": "acquire_skill",
      "trigger": {
        "type": "event",
        "event": "AcquireSkill"
      },
      "actions": [
        {
          "type": "conditional",
          "condition": {
            "type": "binary",
            "op": "gt",
            "left": {
              "type": "field",
              "entity": "entity",
              "component": "Skills",
              "field": "skillPoints"
            },
            "right": {
              "type": "literal",
              "value": 0.0
            }
          },
          "then_actions": [
            {
              "type": "modify",
              "entity": {
                "type": "var",
                "name": "entity"
              },
              "component": "Skills",
              "field": "skillPoints",
              "op": "subtract",
              "value": {
                "type": "literal",
                "value": 1.0
              }
            },
            {
              "type": "schedule",
              "event": "SkillAcquired",
              "fields": {
                "character": {
                  "type": "var",
                  "name": "id"
                }
              }
            }
          ]
        }
      ]
    },
    {
      "id": 19,
      "name": "flee_battle",
      "trigger": {
        "type": "event",
        "event": "FleeFromBattle"
      },
      "actions": [
        {
          "type": "conditional",
          "condition": {
            "type": "binary",
            "op": "gte",
            "left": {
              "type": "var",
              "name": "timeSinceFlee"
            },
            "right": {
              "type": "field",
              "entity": "entity",
              "component": "FleeConfig",
              "field": "fleeCooldown"
            }
          },
          "then_actions": [
            {
              "type": "modify",
              "entity": {
                "type": "var",
                "name": "entity"
              },
              "component": "RunStats",
              "field": "retreatCount",
              "op": "add",
              "value": {
                "type": "literal",
                "value": 1.0
              }
            },
            {
              "type": "modify",
              "entity": {
                "type": "var",
                "name": "entity"
              },
              "component": "RunStats",
              "field": "retreatPenalty",
              "op": "add",
              "value": {
                "type": "field",
                "entity": "entity",
                "component": "FleeConfig",
                "field": "retreatTimePenalty"
              }
            },
            {
              "type": "modify",
              "entity": {
                "type": "var",
                "name": "entity"
              },
              "component": "RunStats",
              "field": "lastFleeTime",
              "op": "set",
              "value": {
                "type": "field",
                "entity": "entity",
                "component": "RunStats",
                "field": "simulationTime"
              }
            },
            {
              "type": "modify",
              "entity": {
                "type": "var",
                "name": "entity"
              },
              "component": "RunStats",
              "field": "canFlee",
              "op": "set",
              "value": {
                "type": "literal",
                "value": false
              }
            },
            {
              "type": "modify",
              "entity": {
                "type": "var",
                "name": "entity"
              },
              "component": "RunStats",
              "field": "totalTime",
              "op": "set",
              "value": {
                "type": "binary",
                "op": "add",
                "left": {
                  "type": "binary",
                  "op": "add",
                  "left": {
                    "type": "field",
                    "entity": "entity",
                    "component": "RunStats",
                    "field": "simulationTime"
                  },
                  "right": {
                    "type": "field",
                    "entity": "entity",
                    "component": "RunStats",
                    "field": "retreatPenalty"
                  }
                },
                "right": {
                  "type": "field",
                  "entity": "entity",
                  "component": "RunStats",
                  "field": "deathPenalty"
                }
              }
            },
            {
              "type": "schedule",
              "event": "DespawnAllEnemies"
            },
            {
              "type": "schedule",
              "event": "SpawnEnemyWave",
              "delay": {
                "type": "literal",
                "value": 0.5
              }
            },
            {
              "type": "schedule",
              "event": "UpdateRunStats"
            }
          ]
        }
      ]
    },
    {
      "id": 20,
      "name": "despawn_enemies",
      "trigger": {
        "type": "event",
        "event": "DespawnAllEnemies"
      },
      "actions": [
        {
          "type": "conditional",
          "condition": {
            "type": "binary",
            "op": "gt",
            "left": {
              "type": "field",
              "entity": "entity",
              "component": "Enemy",
              "field": "tier"
            },
            "right": {
              "type": "literal",
              "value": 0.0
            }
          },
          "then_actions": [
            {
              "type": "modify",
              "entity": {
                "type": "var",
                "name": "entity"
              },
              "component": "Health",
              "field": "current",
              "op": "set",
              "value": {
                "type": "literal",
                "value": 0.0
              }
            },
            {
              "type": "schedule",
              "event": "RemoveEntity",
              "fields": {
                "target": {
                  "type": "var",
                  "name": "id"
                }
              }
            }
          ]
        }
      ]
    },
    {
      "id": 21,
      "name": "update_flee_cooldown",
      "trigger": {
        "type": "event",
        "event": "UpdateRunStats"
      },
      "actions": [
        {
          "type": "conditional",
          "condition": {
            "type": "binary",
            "op": "gte",
            "left": {
              "type": "var",
              "name": "timeSinceFlee"
            },
            "right": {
              "type": "field",
              "entity": "entity",
              "component": "FleeConfig",
              "field": "fleeCooldown"
            }
          },
          "then_actions": [
            {
              "type": "modify",
              "entity": {
                "type": "var",
                "name": "entity"
              },
              "component": "RunStats",
              "field": "canFlee",
              "op": "set",
              "value": {
                "type": "literal",
                "value": true
              }
            }
          ]
        }
      ]
    },
    {
      "id": 22,
      "name": "complete_run",
      "trigger": {
        "type": "event",
        "event": "GameOver"
      },
      "actions": [
        {
          "type": "schedule",
          "event": "SaveRunToLeaderboard",
          "fields": {
            "completionTime": {
              "type": "field",
              "entity": "entity",
              "component": "RunStats",
              "field": "totalTime"
            },
            "enemiesDefeated": {
              "type": "field",
              "entity": "entity",
              "component": "GameState",
              "field": "enemiesDefeated"
            },
            "playerDeaths": {
              "type": "field",
              "entity": "entity",
              "component": "GameState",
              "field": "playerDeaths"
            },
            "retreats": {
              "type": "field",
              "entity": "entity",
              "component": "RunStats",
              "field": "retreatCount"
            },
            "retreatPenalty": {
              "type": "field",
              "entity": "entity",
              "component": "RunStats",
              "field": "retreatPenalty"
            },
            "deathPenalty": {
              "type": "field",
              "entity": "entity",
              "component": "RunStats",
              "field": "deathPenalty"
            },
            "victory": {
              "type": "field",
              "entity": "entity",
              "component": "GameState",
              "field": "victory"
            }
          }
        }
      ]
    },
    {
      "id": 23,
      "name": "start_global_retargeting",
      "trigger": {
        "type": "event",
        "event": "EnemySpawned"
      },
      "actions": [
        {
          "type": "conditional",
          "condition": {
            "type": "binary",
            "op": "and",
            "left": {
              "type": "binary",
              "op": "eq",
              "left": {
                "type": "field",
                "entity": "entity",
                "component": "GameState",
                "field": "currentWave"
              },
              "right": {
                "type": "literal",
                "value": 1.0
              }
            },
            "right": {
              "type": "binary",
              "op": "eq",
              "left": {
                "type": "field",
                "entity": "entity",
                "component": "GameState",
                "field": "retargetingActive"
              },
              "right": {
                "type": "literal",
                "value": false
              }
            }
          },
          "then_actions": [
            {
              "type": "modify",
              "entity": {
                "type": "var",
                "name": "entity"
              },
              "component": "GameState",
              "field": "retargetingActive",
              "op": "set",
              "value": {
                "type": "literal",
                "value": true
              }
            },
            {
              "type": "schedule",
              "event": "CheckAllTargets",
              "delay": {
                "type": "literal",
                "value": 2.0
              }
            }
          ]
        }
      ]
    },
    {
      "id": 24,
      "name": "check_entity_target",
      "trigger": {
        "type": "event",
        "event": "CheckAllTargets"
      },
      "actions": [
        {
          "type": "conditional",
          "condition": {
            "type": "binary",
            "op": "and",
            "left": {
              "type": "binary",
              "op": "gt",
              "left": {
                "type": "field",
                "entity": "entity",
                "component": "Health",
                "field": "current"
              },
              "right": {
                "type": "literal",
                "value": 0.0
              }
            },
            "right": {
              "type": "binary",
              "op": "neq",
              "left": {
                "type": "field",
                "entity": "entity",
                "component": "Target",
                "field": "entity"
              },
              "right": {
                "type": "literal",
                "value": null
              }
            }
          },
          "then_actions": [
            {
              "type": "conditional",
              "condition": {
                "type": "binary",
                "op": "lte",
                "left": {
                  "type": "field",
                  "entity": "target",
                  "component": "Health",
                  "field": "current"
                },
                "right": {
                  "type": "literal",
                  "value": 0.0
                }
              },
              "then_actions": [
                {
                  "type": "modify",
                  "entity": {
                    "type": "var",
                    "name": "entity"
                  },
                  "component": "Target",
                  "field": "entity",
                  "op": "set",
                  "value": {
                    "type": "literal",
                    "value": null
                  }
                },
                {
                  "type": "schedule",
                  "event": "FindNewTarget",
                  "fields": {
                    "seeker": {
                      "type": "var",
                      "name": "id"
                    }
                  }
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "id": 25,
      "name": "reschedule_retargeting",
      "trigger": {
        "type": "event",
        "event": "CheckAllTargets"
      },
      "actions": [
        {
          "type": "conditional",
          "condition": {
            "type": "binary",
            "op": "and",
            "left": {
              "type": "field",
              "entity": "entity",
              "component": "GameState",
              "field": "retargetingActive"
            },
            "right": {
              "type": "binary",
              "op": "eq",
              "left": {
                "type": "field",
                "entity": "entity",
                "component": "GameState",
                "field": "gameOver"
              },
              "right": {
                "type": "literal",
                "value": false
              }
            }
          },
          "then_actions": [
            {
              "type": "schedule",
              "event": "CheckAllTargets",
              "delay": {
                "type": "literal",
                "value": 2.0
              }
            }
          ]
        }
      ]
    }
  ],
  "functions": [
    {
      "id": 0,
      "name": "calculate_damage",
      "params": [
        {
          "name": "base",
          "type": {
            "type": "number"
          }
        },
        {
          "name": "bonus",
          "type": {
            "type": "number"
          }
        }
      ],
      "return_type": {
        "type": "number"
      },
      "body": {
        "type": "binary",
        "op": "add",
        "left": {
          "type": "var",
          "name": "base"
        },
        "right": {
          "type": "var",
          "name": "bonus"
        }
      }
    },
    {
      "id": 1,
      "name": "calculate_exp_for_level",
      "params": [
        {
          "name": "level",
          "type": {
            "type": "number"
          }
        }
      ],
      "return_type": {
        "type": "number"
      },
      "body": {
        "type": "binary",
        "op": "multiply",
        "left": {
          "type": "literal",
          "value": 100.0
        },
        "right": {
          "type": "var",
          "name": "level"
        }
      }
    }
  ]
}